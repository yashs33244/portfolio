(()=>{var e={};e.id=618,e.ids=[618],e.modules={672:(e,t,r)=>{"use strict";r.d(t,{e:()=>s});var o=r(32190);function s(e){return e.method,o.NextResponse.next()}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37740:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let o=require("@prisma/client"),s=global.prisma||new o.PrismaClient},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65501:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>h,serverHooks:()=>m,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{DELETE:()=>p,GET:()=>d,PUT:()=>g});var s=r(96559),a=r(48088),n=r(37719),i=r(32190),l=r(37740),c=r(672);async function u(e){let t=await l.A.post.findUnique({where:{slug:e},include:{categories:!0}});return t&&await l.A.post.update({where:{id:t.id},data:{views:{increment:1}}}),t}async function d(e,t){try{let e=await t.params,r=await u(e.slug);if(!r)return i.NextResponse.json({error:"Post not found"},{status:404});return i.NextResponse.json(r)}catch(e){return console.error("Error fetching post:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e,t){let r=(0,c.e)(e);if(200!==r.status)return r;let o=(await t.params).slug;try{let t=await e.json();console.log(`Updating blog post with slug: ${o}`,t);let r=await l.A.post.findUnique({where:{slug:o},include:{categories:!0}});if(!r)return console.error(`Blog post not found with slug: ${o}`),i.NextResponse.json({error:"Blog post not found"},{status:404});let s={};if(t.categories&&Array.isArray(t.categories))try{let e=t.categories.map(e=>"string"==typeof e?e:e.slug).filter(Boolean);console.log("Category slugs:",e);let o=await l.A.category.findMany({where:{slug:{in:e}}});console.log("Found existing categories:",o);let a=o.reduce((e,t)=>(e[t.slug]=t,e),{}),n=o.map(e=>({id:e.id})),i=e=>e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),c=e.filter(e=>!a[e]).map(e=>{let t=i(e);return Object.values(a).find(e=>e.name.toLowerCase()===t.toLowerCase())?{name:e,slug:e}:{name:t,slug:e}});console.log("Categories to create:",c),s={disconnect:r.categories.map(e=>({id:e.id})),...n.length>0?{connect:n}:{},...c.length>0?{create:c}:{}},console.log("Category operations:",s)}catch(e){console.error("Error processing categories:",e),s={}}let a={title:t.title,content:t.content,excerpt:t.excerpt,coverImage:t.coverImage,published:t.published,featured:t.featured,...t.slug&&t.slug!==o?{slug:t.slug}:{},readingTime:t.readingTime,...Object.keys(s).length>0?{categories:s}:{}};t.author&&(a.author=t.author),console.log("Final update data:",a);try{let e=await l.A.post.update({where:{id:r.id},data:a,include:{categories:!0}});return console.log(`Blog post updated successfully: ${e.title}`),i.NextResponse.json(e)}catch(e){if("P2002"===e.code&&e.meta?.target?.includes("name")){console.log("Category constraint error, falling back to separate operations");let{categories:e,...t}=a,o=await l.A.post.update({where:{id:r.id},data:t,include:{categories:!0}});console.log("Post updated without categories, now handling categories separately");try{let e=s;if(e.disconnect&&e.disconnect.length>0&&await l.A.post.update({where:{id:r.id},data:{categories:{disconnect:e.disconnect}}}),e.connect&&e.connect.length>0&&await l.A.post.update({where:{id:r.id},data:{categories:{connect:e.connect}}}),e.create&&e.create.length>0)for(let t of e.create)try{let e=await l.A.category.findFirst({where:{OR:[{slug:t.slug},{name:t.name}]}});e?await l.A.post.update({where:{id:r.id},data:{categories:{connect:{id:e.id}}}}):await l.A.category.create({data:{name:t.name,slug:t.slug,posts:{connect:{id:r.id}}}})}catch(e){console.error(`Error handling category ${t.name}:`,e)}let t=await l.A.post.findUnique({where:{id:r.id},include:{categories:!0}});return console.log(`Blog post updated successfully with fallback: ${t?.title}`),i.NextResponse.json(t)}catch(e){return console.error("Error in category fallback:",e),i.NextResponse.json(o)}}throw e}}catch(e){if(console.error(`Error updating blog post with slug ${o}:`,e),"P2002"===e.code&&(e.meta?.target||[]).includes("name"))return i.NextResponse.json({error:"A category with this name already exists",details:"Please try a different category name or reuse an existing one",code:e.code},{status:400});return i.NextResponse.json({error:"Failed to update blog post",details:e instanceof Error?e.message:"Unknown error",code:e.code},{status:500})}}async function p(e,t){let r=(0,c.e)(e);if(200!==r.status)return r;try{let e=t.params.slug,r=await l.A.post.findUnique({where:{slug:e}});if(!r)return i.NextResponse.json({error:"Blog post not found"},{status:404});return await l.A.post.delete({where:{id:r.id}}),i.NextResponse.json({message:"Blog post deleted successfully"})}catch(e){return console.error(`Error deleting blog post with slug ${t.params.slug}:`,e),i.NextResponse.json({error:"Failed to delete blog post"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/blog/[slug]/route",pathname:"/api/blog/[slug]",filename:"route",bundlePath:"app/api/blog/[slug]/route"},resolvedPagePath:"/Users/tanishqsingh/Downloads/portfolio-website/app/api/blog/[slug]/route.ts",nextConfigOutput:"standalone",userland:o}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:m}=h;function y(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[447,580],()=>r(65501));module.exports=o})();